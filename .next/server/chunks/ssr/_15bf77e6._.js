module.exports=[96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},77994,a=>{"use strict";var b=a.i(72131);function c(a){let c=b.useRef({value:a,previous:a});return b.useMemo(()=>(c.current.value!==a&&(c.current.previous=c.current.value,c.current.value=a),c.current.previous),[a])}a.s(["usePrevious",()=>c])},30656,a=>{"use strict";function b(a,[b,c]){return Math.min(c,Math.max(b,a))}a.s(["clamp",()=>b])},6272,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(87532),f=a.i(45222);let g=(0,a.i(70106).default)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);var h=a.i(96221),i=a.i(38246),j=a.i(95445);let k={async getAllSessions(a){let b=j.supabase.from("chat_sessions").select("*, assigned:profiles(full_name, avatar_url)").order("created_at",{ascending:!1});a?.status&&(b=b.eq("status",a.status)),a?.assigned_to&&(b=b.eq("assigned_to",a.assigned_to));let{data:c,error:d}=await b;if(d)throw d;return c},async getSessionById(a){let{data:b,error:c}=await j.supabase.from("chat_sessions").select("*, assigned:profiles(full_name, avatar_url)").eq("id",a).single();if(c)throw c;return b},async createSession(a){let{data:b,error:c}=await j.supabase.from("chat_sessions").insert(a).select().single();if(c)throw c;return b},async updateSession(a,b){let{data:c,error:d}=await j.supabase.from("chat_sessions").update(b).eq("id",a).select().single();if(d)throw d;return c},async assignSession(a,b){let{data:c,error:d}=await j.supabase.from("chat_sessions").update({assigned_to:b,status:"active"}).eq("id",a).select().single();if(d)throw d;return c},async closeSession(a,b){let{data:c,error:d}=await j.supabase.from("chat_sessions").update({status:"closed",ended_at:new Date().toISOString(),...b&&{rating:b}}).eq("id",a).select().single();if(d)throw d;return c},async getMessages(a){let{data:b,error:c}=await j.supabase.from("chat_messages").select("*").eq("session_id",a).order("created_at");if(c)throw c;return b},async sendMessage(a){let{data:b,error:c}=await j.supabase.from("chat_messages").insert(a).select().single();if(c)throw c;return b},async markAsRead(a){let{data:b,error:c}=await j.supabase.from("chat_messages").update({is_read:!0}).eq("id",a).select().single();if(c)throw c;return b},subscribeToSession:(a,b)=>j.supabase.channel(`chat:${a}`).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages",filter:`session_id=eq.${a}`},b).subscribe()};var l=a.i(42463),m=a.i(99570),n=a.i(66718),o=a.i(23292),p=a.i(80701);function q(){let{user:a}=(0,l.useAuth)(),[j,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)("all");(0,c.useEffect)(()=>{x()},[v]);let x=async()=>{try{let a=await k.getAllSessions(v&&"all"!==v?{status:v}:void 0);q(a||[])}catch(a){o.toast.error("Failed to load chat sessions")}finally{s(!1)}},y=async b=>{if(a)try{await k.assignSession(b,a.id),x(),o.toast.success("Session assigned")}catch(a){o.toast.error("Failed to assign session")}},z=j.filter(a=>a.visitor_name?.toLowerCase().includes(t.toLowerCase())||a.visitor_email?.toLowerCase().includes(t.toLowerCase()));return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Chat Sessions"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage visitor conversations"})]})}),(0,b.jsxs)("div",{className:"flex items-center gap-4 bg-card p-4 rounded-xl border border-border",children:[(0,b.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,b.jsx)(e.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,b.jsx)(n.Input,{placeholder:"Search sessions...",value:t,onChange:a=>u(a.target.value),className:"pl-9"})]}),(0,b.jsxs)(p.Select,{value:v,onValueChange:w,children:[(0,b.jsx)(p.SelectTrigger,{className:"w-[180px]",children:(0,b.jsx)(p.SelectValue,{placeholder:"All statuses"})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"all",children:"All"}),(0,b.jsx)(p.SelectItem,{value:"active",children:"Active"}),(0,b.jsx)(p.SelectItem,{value:"waiting",children:"Waiting"}),(0,b.jsx)(p.SelectItem,{value:"closed",children:"Closed"})]})]})]}),r?(0,b.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,b.jsx)(h.Loader2,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):0===z.length?(0,b.jsxs)("div",{className:"text-center py-20 bg-card rounded-xl border border-border border-dashed",children:[(0,b.jsx)(f.MessageCircle,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"No active chat sessions"})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:z.map((a,c)=>(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*c},className:"bg-card border border-border rounded-xl p-6 hover:shadow-lg transition-all",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center",children:(0,b.jsx)(g,{className:"w-6 h-6 text-accent"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold",children:a.visitor_name||"Anonymous"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.visitor_email})]})]}),(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"active"===a.status?"bg-green-500/10 text-green-500":"waiting"===a.status?"bg-blue-500/10 text-blue-500":"bg-secondary text-muted-foreground"}`,children:a.status})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:a.assigned?.full_name?(0,b.jsxs)("span",{children:["Assigned to ",a.assigned.full_name]}):(0,b.jsx)("span",{children:"Unassigned"})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[!a.assigned_to&&(0,b.jsx)(m.Button,{size:"sm",variant:"outline",onClick:()=>y(a.id),children:"Assign to Me"}),(0,b.jsx)(i.default,{href:`/admin/chat/${a.id}`,children:(0,b.jsx)(m.Button,{size:"sm",className:"bg-accent hover:bg-accent/90",children:"View Chat"})})]})]}),(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t border-border text-xs text-muted-foreground",children:["Started ",new Date(a.created_at).toLocaleString()]})]},a.id))})]})}a.s(["default",()=>q],6272)}];

//# sourceMappingURL=_15bf77e6._.js.map