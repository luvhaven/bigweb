(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,31278,e=>{"use strict";let s=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},99682,e=>{"use strict";var s=e.i(71645);function t(e){let t=s.useRef({value:e,previous:e});return s.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}e.s(["usePrevious",()=>t])},70152,e=>{"use strict";function s(e,[s,t]){return Math.min(t,Math.max(s,e))}e.s(["clamp",()=>s])},59326,e=>{"use strict";var s=e.i(43476),t=e.i(71645),a=e.i(46932),i=e.i(55436),r=e.i(94983);let l=(0,e.i(75254).default)("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]);var n=e.i(31278),c=e.i(22016),o=e.i(11795);let d={async getAllSessions(e){let s=o.supabase.from("chat_sessions").select("*, assigned:profiles(full_name, avatar_url)").order("created_at",{ascending:!1});e?.status&&(s=s.eq("status",e.status)),e?.assigned_to&&(s=s.eq("assigned_to",e.assigned_to));let{data:t,error:a}=await s;if(a)throw a;return t},async getSessionById(e){let{data:s,error:t}=await o.supabase.from("chat_sessions").select("*, assigned:profiles(full_name, avatar_url)").eq("id",e).single();if(t)throw t;return s},async createSession(e){let{data:s,error:t}=await o.supabase.from("chat_sessions").insert(e).select().single();if(t)throw t;return s},async updateSession(e,s){let{data:t,error:a}=await o.supabase.from("chat_sessions").update(s).eq("id",e).select().single();if(a)throw a;return t},async assignSession(e,s){let{data:t,error:a}=await o.supabase.from("chat_sessions").update({assigned_to:s,status:"active"}).eq("id",e).select().single();if(a)throw a;return t},async closeSession(e,s){let{data:t,error:a}=await o.supabase.from("chat_sessions").update({status:"closed",ended_at:new Date().toISOString(),...s&&{rating:s}}).eq("id",e).select().single();if(a)throw a;return t},async getMessages(e){let{data:s,error:t}=await o.supabase.from("chat_messages").select("*").eq("session_id",e).order("created_at");if(t)throw t;return s},async sendMessage(e){let{data:s,error:t}=await o.supabase.from("chat_messages").insert(e).select().single();if(t)throw t;return s},async markAsRead(e){let{data:s,error:t}=await o.supabase.from("chat_messages").update({is_read:!0}).eq("id",e).select().single();if(t)throw t;return s},subscribeToSession:(e,s)=>o.supabase.channel(`chat:${e}`).on("postgres_changes",{event:"*",schema:"public",table:"chat_messages",filter:`session_id=eq.${e}`},s).subscribe()};var u=e.i(66643),m=e.i(19455),h=e.i(93479),g=e.i(46696),x=e.i(67489);function f(){let{user:e}=(0,u.useAuth)(),[o,f]=(0,t.useState)([]),[p,v]=(0,t.useState)(!0),[b,j]=(0,t.useState)(""),[y,w]=(0,t.useState)("all");(0,t.useEffect)(()=>{_()},[y]);let _=async()=>{try{let e=await d.getAllSessions(y&&"all"!==y?{status:y}:void 0);f(e||[])}catch(e){g.toast.error("Failed to load chat sessions")}finally{v(!1)}},S=async s=>{if(e)try{await d.assignSession(s,e.id),_(),g.toast.success("Session assigned")}catch(e){g.toast.error("Failed to assign session")}},N=o.filter(e=>e.visitor_name?.toLowerCase().includes(b.toLowerCase())||e.visitor_email?.toLowerCase().includes(b.toLowerCase()));return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Chat Sessions"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Manage visitor conversations"})]})}),(0,s.jsxs)("div",{className:"flex items-center gap-4 bg-card p-4 rounded-xl border border-border",children:[(0,s.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,s.jsx)(i.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),(0,s.jsx)(h.Input,{placeholder:"Search sessions...",value:b,onChange:e=>j(e.target.value),className:"pl-9"})]}),(0,s.jsxs)(x.Select,{value:y,onValueChange:w,children:[(0,s.jsx)(x.SelectTrigger,{className:"w-[180px]",children:(0,s.jsx)(x.SelectValue,{placeholder:"All statuses"})}),(0,s.jsxs)(x.SelectContent,{children:[(0,s.jsx)(x.SelectItem,{value:"all",children:"All"}),(0,s.jsx)(x.SelectItem,{value:"active",children:"Active"}),(0,s.jsx)(x.SelectItem,{value:"waiting",children:"Waiting"}),(0,s.jsx)(x.SelectItem,{value:"closed",children:"Closed"})]})]})]}),p?(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsx)(n.Loader2,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):0===N.length?(0,s.jsxs)("div",{className:"text-center py-20 bg-card rounded-xl border border-border border-dashed",children:[(0,s.jsx)(r.MessageCircle,{className:"w-12 h-12 mx-auto mb-4 opacity-20"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"No active chat sessions"})]}):(0,s.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:N.map((e,t)=>(0,s.jsxs)(a.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*t},className:"bg-card border border-border rounded-xl p-6 hover:shadow-lg transition-all",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center",children:(0,s.jsx)(l,{className:"w-6 h-6 text-accent"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold",children:e.visitor_name||"Anonymous"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.visitor_email})]})]}),(0,s.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"active"===e.status?"bg-green-500/10 text-green-500":"waiting"===e.status?"bg-blue-500/10 text-blue-500":"bg-secondary text-muted-foreground"}`,children:e.status})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.assigned?.full_name?(0,s.jsxs)("span",{children:["Assigned to ",e.assigned.full_name]}):(0,s.jsx)("span",{children:"Unassigned"})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[!e.assigned_to&&(0,s.jsx)(m.Button,{size:"sm",variant:"outline",onClick:()=>S(e.id),children:"Assign to Me"}),(0,s.jsx)(c.default,{href:`/admin/chat/${e.id}`,children:(0,s.jsx)(m.Button,{size:"sm",className:"bg-accent hover:bg-accent/90",children:"View Chat"})})]})]}),(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-border text-xs text-muted-foreground",children:["Started ",new Date(e.created_at).toLocaleString()]})]},e.id))})]})}e.s(["default",()=>f],59326)}]);